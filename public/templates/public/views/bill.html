{% extends "../components/base.html" %}
{% load custom_tags %}
{% load static %}

{% block title %}{{ bill.identifier }} - {{ state|state_name }} {{ bill.from_organization.name }} ({{bill.legislative_session.identifier }}) - Open States{% endblock %}
{% block description %}Details on {{ state|state_name }} {{ bill.identifier}} ({{ bill.legislative_session }}) - {{ bill.title }}{% endblock %}

{% block content %}
    <section>
        <h1>{{ bill.identifier }}</h1>
        <span>{{state|state_name}} {{ bill.from_organization.name }} {{ bill.classification.0|title }} Â· {{ bill.legislative_session.name }}</span>

        <div class="stages">
            {% for stage in stages %}
            <div class="stage">
                {% if stage.date %}
                    <span>{{ stage.text }}</span>
                    <div style="stage--green"></div>
                    <span>{{ stage.date }}</span>
                {% else %}
                    <span>{{ stage.stage }}</span>
                    <div style="stage--gray"></div>
                    <span>{{ stage.date }}</span>
                {% endif %}
            </div>
            {% endfor %}
        </div>

        <span>{{ bill.title }}</span>
        <a class="button" href="{{ read_link }}">View Latest Bill Text</a>

        <h2>Bill Sponsors</h2>
        {% for sponsor in sponsorships|dictsortreversed:"primary" %}
            <div>
                <!-- Can offer much more information if the Person object is properly linked -->
                {% if sponsor.person %}
                    {% if sponsor.person.headshot_url %}
                        <img src="{{ sponsor.person.headshot_url }}" alt="headshot for {{ sponsor.person.name }}" />
                    {% else %}
                        <img src="{% static "public/img/placeholder-headshot.png" %}" alt="placeholder headshot" />
                    {% endif %}

                    <span>{{ sponsor.person.name }}</span>
                    <span>TO-DO (PARTY) DISTRICT</span>

                    <span>{{ sponsor.classification|title }}</span>
                {% else %}
                    <img src="{% static "public/img/placeholder-headshot.png" %}" alt="placeholder headshot" />

                    <span>{{ sponsor.name }}</span>

                    <span>{{ sponsor.classification|title }}</span>
                {% endif %}
            </div>
        {% endfor %}

        {% if bill.subject %}
            <h2>Bill Subjects</h2>
            {% for subject in bill.subject %}
                <a class="button">{{ subject }}</a>
            {% endfor %}
        {% endif %}
    </section>

    <section>
        <h1>Recent Votes</h1>
        {% regroup votes by start_date as votes_by_date %}
        {% for start_date in votes_by_date reversed %}
            <span>{{ start_date.grouper }}</span>
            {% for vote_event in start_date.list %}
                {% vote_card vote_event %}
            {% endfor %}
        {% endfor %}
    </section>

    <section>
        <h1>Actions</h1>
        {% regroup actions by date as actions_by_date %}
        {% for date in actions_by_date reversed %}
            <span>{{ date.grouper }}</span>
            {% for action in date.list %}
                {% action_card action %}
            {% endfor %}
        {% endfor %}
    </section>

    <section>
        <h1>Bill Text</h1>
        <ul>
            {% for version in versions reversed %}
            {% document_card version %}
            {% endfor %}
        </ul>
    </section>

    <section>
        <h1>Related Documents</h1>
        <ul>
            {% for document in documents reversed %}
            {% document_card document %}
            {% endfor %}
        </ul>
    </section>

    {% sources state bill.sources.all %}
{% endblock %}
