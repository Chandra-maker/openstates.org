{% extends "../components/base.html" %}
{% load custom_tags %}
{% load static %}

{% block content %}
    <section>
        {% if person.image %}
            <img src="{{ person.image }}" alt="legislator headshot" />
        {% else %}
            <img src="{% static "public/img/placeholder-headshot.png" %}" alt="placeholder headshot" />
        {% endif %}
        <h2>{{ person.name }}</h2>
        <span>{{ person.party }} · {{ person.role }} · District {{ person.district }}</span>

        <div style="width:250px;height:250px" data-hook="legislator-map" data-value="{{ person.division_id }}"></div>

        <div class="contact-details">
        {% if person.all_contact_details %}
            {% regroup person.all_contact_details by note as contact_details %}
            {% for note, cd_list in contact_details %}
                <h2>{{ note }}</h2>
                <address><ul>
                {% for cd in cd_list %}
                    <li class="contact-{{ cd.type }}">
                    {% if cd.type == 'voice' %}
                        <a href="tel:{{ cd.value }}">{{ cd.value }}</a>
                    {% elif cd.type == 'fax' %}
                        <span class="fax">{{ cd.value }}</span>
                    {% elif cd.type == 'email' %}
                        <a href="mailto:{{ cd.value }}">{{ cd.value }}</a>
                    {% elif cd.type == 'address' %}
                        {{ cd.value }}
                    {% endif %}
                    </li>
                {% endfor %}
                </ul></address>
            {% endfor %}
        {% endif %}
        </div>

        {% if person.committee_memberships %}
            <h1>Committee Memberships</h1>
            <ul>
            {% for committee in person.committee_memberships %}
            <li><a href="#">{{ committee.organization.name }}</a> {% if committee.role.lower != 'member' %} {{ committee.role }} {% endif %}</li>
            {% endfor %}
            </ul>
        {% endif %}
    </section>

    <section>
        <h1>Sponsored Bills</h1>
        {% for bill in person.sponsored_bills %}
            <div>
                <h2><a href="{% url 'bill' state bill.id %}">{{ bill.identifier }}</a></h2>
                <span>{{ bill.title }}</span>
            </div>
        {% endfor %}
        {% if person.sponsored_bills %}<a class="button">View more bills</a>{% endif %}
    </section>

    <section>
        <h1>Recent Votes</h1>
        {% regroup person.vote_events by start_date as votes_by_date %}
        {% for start_date in votes_by_date reversed %}
            <span>{{ start_date.grouper }}</span>
            {% for vote_event in start_date.list %}
                {% vote_card vote_event %}
            {% endfor %}
        {% endfor %}
    </section>

    {% sources state person.sources.all %}
{% endblock %}
