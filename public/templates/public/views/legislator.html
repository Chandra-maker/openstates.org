{% extends "../components/base.html" %}
{% load custom_tags %}
{% load static %}

{% block title %}{{ person.name }} - {{ state|state_name }} {{ person.current_role.role }} - Open States{% endblock %}
{% block description %}Contact information and legislative record for {{ person.name }} in  {{ state|state_name }}.{% endblock %}

{% block content %}
<section class="section">

    <div class="overview">
        
        <div class="overview__header">
            {% if person.image %}
                <img class="thumbnail mr1" src="{{ person.image_url }}" alt="Headshot of {{ person.name }}" onerror="window.imgError(this)">
            {% else %}
                <div class="card__image card__image--placeholder"></div>
            {% endif %}
            <div>
                <h2 class="overview__heading">{{ person.name }}</h2>
                <ul class="card__detail-group">
                    {% if retired %}
                    <li class="card__detail type--xsmall">Former {{ state|state_name}} Legislator</li>
                    {% else %}
                    <li class="card__detail type--xsmall">{{ person.current_role.party }}</li>
                    <li class="card__detail type--xsmall">{{ person.current_role.role }}</li>
                    <li class="card__detail type--xsmall">District {{ person.current_role.district }}</a></li>
                    {% endif %}
                </ul>
            </div>
        </div>

        <div class="overview__section overview__section--parent">
            {% if person.all_contact_details %}
                {% regroup person.all_contact_details by note as contact_details %}
                {% for note, cd_list in contact_details %}
                <div class="overview__subsection">
                    <address class="contact">
                        <h3 class="heading--small">{{ note }}</h3>
                        {% for cd in cd_list %}
                            <p>
                            {% if cd.type == 'address' %}
                                {{ cd.value|format_address }}
                            {% elif cd.type == 'voice' %}
                                <span class="contact__label">Phone</span>
                                <a href="tel:{{ cd.value }}">{{ cd.value }}</a>
                            {% elif cd.type == 'fax' %}
                                <span class="contact__label">Fax</span>
                                {{ cd.value }}
                            {% elif cd.type == 'email' %}
                                <span class="contact__label">Email</span>
                                <a href="mailto:{{ cd.value }}">{{ cd.value }}</a>
                            {% endif %}
                            </p>
                        {% endfor %}
                    </address>
                </div>
                {% endfor %}
            {% endif %}

            {% if not retired %}
            <div class="overview__subsection overview__subsection--map">
                <p class="heading--xsmall">Serving District {{ person.current_role.district }}</p>
                <div style="width:280px;height:215px" data-hook="legislator-map" data-value="{{ person.current_role.division_id }}"></div>
            </div>
            {% endif %}
        </div>
        
        {% if person.committee_memberships %}
        <div class="overview__section">
            <h3 class="heading--xsmall">Committee Memberships ({{ person.committee_memberships|length }})</h3>
            {% for committee in person.committee_memberships %}
            <!-- TODO: Add real links to committees -->
            <a class="label" link="#">
                <svg class="label__icon"><use xlink:href="{% static 'public/images/icons.svg' %}#icon-group"></use></svg>
                {{ committee.organization.name }}
                {% if committee.role.lower != 'member' %}
                <span style="font-weight: normal;">
                    | {{ committee.role|title }}
                </span>
                {% endif %}
            </a>
            {% endfor %}
        </div>
        {% endif %}

    </div>
</section>


<section class="section">
    <h3 class="heading--medium">Sponsored Bills</h3>
    {% for bill in person.sponsored_bills %}
        <div class="card">
                <h3 class="heading--small"><a href="{% canonical_url bill %}">{{ bill.identifier }}</a></h3>
                <p>{{ bill.title }}</p>
        </div>
    {% endfor %}
    {% if person.sponsored_bills %}<a class="button">View more bills</a>{% endif %}
</section>


<section class="section">
    <h3 class="heading--medium">Recent Votes</h3>

    <div class="timeline">
    {% regroup person.vote_events by start_date as votes_by_date %}
    {% for start_date in votes_by_date reversed %}
        <div class="timeline-item">
            <div class="timeline-date">
                <!-- TODO: Format more readable timestamp -->
                <h3 class="heading--xsmall">{{ start_date.grouper }}</h3>
            </div>
            
            {% for vote_event in start_date.list %}
            <div class="timeline-activity">
                {% vote_card vote_event %}
            </div>
            {% endfor %}
        </div>
    {% endfor %}
</section>

{% sources state person.sources.all %}

{% endblock %}
